(this["webpackJsonp"]=this["webpackJsonp"]||[]).push([["app-service"],{"08aa":function(t,e,n){"use strict";n.r(e);var r=n("2030"),s=n("c790");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"4b7a614e",null,!1,r["a"],void 0);e["default"]=o.exports},"0ee4":function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}t.exports=n},"104b":function(t,e,n){"use strict";n.r(e);var r=n("89fe"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},1177:function(t,e,n){"use strict";n.r(e);var r=n("7136");for(var s in r)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(s);var i=n("828b"),a=Object(i["a"])(r["default"],void 0,void 0,!1,null,null,null,!1,void 0,void 0);e["default"]=a.exports},"127e":function(t,e,n){var r=n("3b2d"),s=n("9fc1")();t.exports=s;try{regeneratorRuntime=s}catch(i){"object"===("undefined"===typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}},"12d1":function(t,e,n){"use strict";n.r(e);var r=n("6eb0"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"1c5e":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","section"),attrs:{_i:1}},[n("view",{staticClass:t._$s(2,"sc","section-title"),attrs:{_i:2}}),t._$s(3,"i",!t.incoming.length)?n("view",{staticClass:t._$s(3,"sc","empty"),attrs:{_i:3}}):t._e(),t._l(t._$s(4,"f",{forItems:t.incoming}),(function(e,r,s,i){return n("view",{key:t._$s(4,"f",{forIndex:s,key:e.id}),staticClass:t._$s("4-"+i,"sc","card request"),attrs:{_i:"4-"+i}},[n("view",{staticClass:t._$s("5-"+i,"sc","name"),attrs:{_i:"5-"+i}},[t._v(t._$s("5-"+i,"t0-0",t._s(e.from_user&&e.from_user.username||e.from_user_id)))]),n("view",{staticClass:t._$s("6-"+i,"sc","actions"),attrs:{_i:"6-"+i}},[n("button",{attrs:{_i:"7-"+i},on:{click:function(n){return t.accept(e.id)}}}),n("button",{attrs:{_i:"8-"+i},on:{click:function(n){return t.reject(e.id)}}})])])}))],2),n("view",{staticClass:t._$s(9,"sc","section mt-32"),attrs:{_i:9}},[n("view",{staticClass:t._$s(10,"sc","section-title"),attrs:{_i:10}}),t._$s(11,"i",!t.outgoing.length)?n("view",{staticClass:t._$s(11,"sc","empty"),attrs:{_i:11}}):t._e(),t._l(t._$s(12,"f",{forItems:t.outgoing}),(function(e,r,s,i){return n("view",{key:t._$s(12,"f",{forIndex:s,key:e.id}),staticClass:t._$s("12-"+i,"sc","card request"),attrs:{_i:"12-"+i}},[n("view",{staticClass:t._$s("13-"+i,"sc","name"),attrs:{_i:"13-"+i}},[t._v(t._$s("13-"+i,"t0-0",t._s(e.to_user&&e.to_user.username||e.to_user_id)))]),n("view",{staticClass:t._$s("14-"+i,"sc","text-sub"),attrs:{_i:"14-"+i}})])}))],2)])},s=[]},"1d79":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","title"),attrs:{_i:1}}),n("view",{staticClass:t._$s(2,"sc","card mt-24"),attrs:{_i:2}},[n("view",{staticClass:t._$s(3,"sc","field"),attrs:{_i:3}},[n("text",{staticClass:t._$s(4,"sc","label"),attrs:{_i:4}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],staticClass:t._$s(5,"sc","input"),attrs:{_i:5},domProps:{value:t._$s(5,"v-model",t.form.username)},on:{input:function(e){e.target.composing||t.$set(t.form,"username",e.target.value)}}})]),n("view",{staticClass:t._$s(6,"sc","field mt-24"),attrs:{_i:6}},[n("text",{staticClass:t._$s(7,"sc","label"),attrs:{_i:7}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],staticClass:t._$s(8,"sc","input"),attrs:{_i:8},domProps:{value:t._$s(8,"v-model",t.form.password)},on:{input:function(e){e.target.composing||t.$set(t.form,"password",e.target.value)}}})]),n("button",{staticClass:t._$s(9,"sc","btn mt-32"),attrs:{_i:9},on:{click:t.handleRegister}}),n("view",{staticClass:t._$s(10,"sc","text-sub mt-16"),attrs:{_i:10}},[n("text",{staticClass:t._$s(11,"sc","link"),attrs:{_i:11},on:{click:t.goLogin}})])])])},s=[]},"1f07":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[t._$s(1,"i",!t.sessionList.length)?n("view",{staticClass:t._$s(1,"sc","empty"),attrs:{_i:1}}):n("view",{staticClass:t._$s(2,"sc","list"),attrs:{_i:2}},t._l(t._$s(3,"f",{forItems:t.sessionList}),(function(e,r,s,i){return n("view",{key:t._$s(3,"f",{forIndex:s,key:e.peerId}),staticClass:t._$s("3-"+i,"sc","session card"),attrs:{_i:"3-"+i},on:{click:function(n){return t.openChat(e)}}},[n("avatar",{staticClass:t._$s("4-"+i,"sc","avatar"),attrs:{name:e.name,avatar:e.avatar,size:80,_i:"4-"+i}}),n("view",{staticClass:t._$s("5-"+i,"sc","center"),attrs:{_i:"5-"+i}},[n("view",{staticClass:t._$s("6-"+i,"sc","top-row"),attrs:{_i:"6-"+i}},[n("text",{staticClass:t._$s("7-"+i,"sc","name"),attrs:{_i:"7-"+i}},[t._v(t._$s("7-"+i,"t0-0",t._s(e.name)))]),n("text",{staticClass:t._$s("8-"+i,"sc","time"),attrs:{_i:"8-"+i}},[t._v(t._$s("8-"+i,"t0-0",t._s(e.time)))])]),n("view",{staticClass:t._$s("9-"+i,"sc","bottom-row"),attrs:{_i:"9-"+i}},[n("text",{staticClass:t._$s("10-"+i,"sc","preview"),attrs:{_i:"10-"+i}},[t._v(t._$s("10-"+i,"t0-0",t._s(e.preview)))]),t._$s("11-"+i,"i",e.unread)?n("view",{staticClass:t._$s("11-"+i,"sc","badge"),attrs:{_i:"11-"+i}},[t._v(t._$s("11-"+i,"t0-0",t._s(e.unread)))]):t._e()])])],1)})),0)])},s=[]},2030:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","input-wrap"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","input-bar"),attrs:{_i:1}},[n("view",{staticClass:t._$s(2,"sc","emoji-btn"),attrs:{_i:2},on:{click:t.toggleEmoji}}),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:t._$s(3,"sc","textarea"),attrs:{_i:3},domProps:{value:t._$s(3,"v-model",t.content)},on:{confirm:t.onSend,input:function(e){e.target.composing||(t.content=e.target.value)}}}),n("button",{staticClass:t._$s(4,"sc","send-btn"),attrs:{_i:4},on:{click:t.onSend}})]),t._$s(5,"i",t.showEmoji)?n("view",{staticClass:t._$s(5,"sc","emoji-panel"),attrs:{_i:5}},t._l(t._$s(6,"f",{forItems:t.emojis}),(function(e,r,s,i){return n("view",{key:t._$s(6,"f",{forIndex:s,key:e}),staticClass:t._$s("6-"+i,"sc","emoji-item"),attrs:{_i:"6-"+i},on:{click:function(n){return t.appendEmoji(e)}}},[t._v(t._$s("6-"+i,"t0-0",t._s(e)))])})),0):t._e()])},s=[]},2108:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.setupWS=e.sendMessage=e.connect=e.close=void 0;var r=n("fde0"),s=null,i=null,a=null,o=!1;e.setupWS=function(t){s=t};var c=function(){a&&(clearTimeout(a),a=null)},u=function(){c(),o||(a=setTimeout((function(){var t=uni.getStorageSync(r.storageKeys.token);t&&f(t)}),3e3))},f=function(e){e&&s&&(i&&(i.close(),i=null),o=!1,i=uni.connectSocket({url:"".concat(r.config.wsURL,"?token=").concat(e),complete:function(){}}),i.onOpen((function(){s.commit("messages/setWsStatus","open")})),i.onMessage((function(e){try{var n=JSON.parse(e.data);"message"===n.type?s.dispatch("messages/receiveIncoming",n):"error"===n.type&&uni.showToast({title:n.message||"WS\u9519\u8bef",icon:"none"})}catch(r){t("warn","WS parse error",r," at common/ws.js:53")}})),i.onClose((function(){s.commit("messages/setWsStatus","closed"),u()})),i.onError((function(){s.commit("messages/setWsStatus","error"),u()})))};e.connect=f;e.sendMessage=function(t){i?i.send({data:JSON.stringify(t)}):uni.showToast({title:"\u8fde\u63a5\u4e2d\uff0c\u7a0d\u540e\u518d\u8bd5",icon:"none"})};e.close=function(){o=!0,c(),i&&(i.close(),i=null)}}).call(this,n("f3b9")["default"])},"25b1":function(t,e,n){"use strict";n.r(e);var r=n("8f5b"),s=n("4996");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"184ae7ac",null,!1,r["a"],void 0);e["default"]=o.exports},"29bc":function(t,e,n){"use strict";n.r(e);var r=n("9dea"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"2e4e":function(t,e,n){"use strict";var r=n("47a9"),s=r(n("7ca3"));n("e910");var i=r(n("951c")),a=r(n("1177")),o=r(n("d997")),c=n("2108");function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}i.default.config.productionTip=!1,(0,c.setupWS)(o.default);var f=o.default.state.auth.token;f&&(0,c.connect)(f),a.default.mpType="app";var l=new i.default(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){(0,s.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({store:o.default},a.default));l.$mount()},"306b":function(t,e,n){"use strict";n.r(e);var r=n("1d79"),s=n("e183");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"0adf7d43",null,!1,r["a"],void 0);e["default"]=o.exports},"3b2d":function(t,e){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports["default"]=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports["default"]=t.exports},"3c68":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticClass:this._$s(0,"sc","container"),attrs:{_i:0}},[e("web-view",{attrs:{src:this._$s(1,"a-src",this.src),_i:1}})])},s=[]},"44d7":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=n("fde0"),o=n("2108"),c=n("51b7"),u={setToken:function(t,e){t.token=e,e?uni.setStorageSync(a.storageKeys.token,e):uni.removeStorageSync(a.storageKeys.token)},setUser:function(t,e){t.user=e,e?uni.setStorageSync(a.storageKeys.user,e):uni.removeStorageSync(a.storageKeys.user)},clear:function(t){t.token="",t.user=null,uni.removeStorageSync(a.storageKeys.token),uni.removeStorageSync(a.storageKeys.user)}},f={login:function(t,e){return(0,i.default)(s.default.mark((function n(){var r,i,a,u;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.commit,i=t.dispatch,a=t.rootState,n.next=3,(0,c.login)(e);case 3:return u=n.sent,r("setToken",u.access_token),n.next=7,i("fetchMe");case 7:(0,o.connect)(u.access_token),a.messages&&i("messages/syncUnread",null,{root:!0});case 9:case"end":return n.stop()}}),n)})))()},register:function(t,e){return(0,i.default)(s.default.mark((function n(){var r;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.dispatch,n.next=3,(0,c.register)(e);case 3:return n.next=5,r("login",e);case 5:case"end":return n.stop()}}),n)})))()},fetchMe:function(t){return(0,i.default)(s.default.mark((function e(){var n,r,i;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.commit,r=t.state,r.token){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,(0,c.fetchMe)();case 5:i=e.sent,n("setUser",i);case 7:case"end":return e.stop()}}),e)})))()},logout:function(t){var e=t.commit;e("clear"),(0,o.close)(),uni.reLaunch({url:"/pages/auth/login"})}},l={namespaced:!0,state:function(){return{token:uni.getStorageSync(a.storageKeys.token)||"",user:uni.getStorageSync(a.storageKeys.user)||null}},getters:{isAuthed:function(t){return!!t.token}},mutations:u,actions:f};e.default=l},"47a9":function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}},t.exports.__esModule=!0,t.exports["default"]=t.exports},"47f6":function(t,e,n){"use strict";n.r(e);var r=n("8f3c"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},4996:function(t,e,n){"use strict";n.r(e);var r=n("5888"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"4cf1":function(t,e,n){"use strict";n.r(e);var r=n("ab93"),s=n("8dca");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"060553f6",null,!1,r["a"],void 0);e["default"]=o.exports},"4da1":function(t,e,n){"use strict";n.r(e);var r=n("1c5e"),s=n("29bc");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"2a9f2202",null,!1,r["a"],void 0);e["default"]=o.exports},"51b7":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.sendMessageApi=e.sendFriendRequest=e.searchUsers=e.register=e.login=e.handleFriendRequest=e.fetchUnread=e.fetchMe=e.fetchHistory=e.fetchFriends=e.fetchFriendRequests=void 0;var s=r(n("c367"));e.register=function(t){return(0,s.default)({url:"/auth/register",method:"POST",data:t})};e.login=function(t){var e=t.username,n=t.password;return(0,s.default)({url:"/auth/login",method:"POST",data:"username=".concat(encodeURIComponent(e),"&password=").concat(encodeURIComponent(n)),header:{"content-type":"application/x-www-form-urlencoded"}})};e.fetchMe=function(){return(0,s.default)({url:"/users/me",method:"GET"})};e.searchUsers=function(t){return(0,s.default)({url:"/users/search?keyword=".concat(encodeURIComponent(t)),method:"GET"})};e.sendFriendRequest=function(t){return(0,s.default)({url:"/friends/requests",method:"POST",data:{to_user_id:t}})};e.fetchFriendRequests=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"incoming";return(0,s.default)({url:"/friends/requests/".concat(t),method:"GET"})};e.handleFriendRequest=function(t,e){return(0,s.default)({url:"/friends/requests/".concat(t,"/").concat(e),method:"POST"})};e.fetchFriends=function(){return(0,s.default)({url:"/friends",method:"GET"})};e.sendMessageApi=function(t){var e=t.receiver_id,n=t.content,r=t.content_type,i=void 0===r?"text":r;return(0,s.default)({url:"/messages",method:"POST",data:{receiver_id:e,content:n,content_type:i}})};e.fetchHistory=function(t){var e=t.peer_user_id,n=t.limit,r=void 0===n?50:n,i=t.before,a="/messages/history?peer_user_id=".concat(e,"&limit=").concat(r);return i&&(a+="&before=".concat(encodeURIComponent(i))),(0,s.default)({url:a,method:"GET"})};e.fetchUnread=function(){return(0,s.default)({url:"/messages/unread",method:"GET"})}},"575c":function(t,e,n){"use strict";n.r(e);var r=n("640f"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},5888:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={props:{messages:{type:Array,default:function(){return[]}},currentUserId:{type:Number,default:null}},computed:{lastId:function(){if(!this.messages.length)return"bottom-anchor";var t=this.messages[this.messages.length-1];return this.domId(t)}},data:function(){return{scrollId:"bottom-anchor"}},watch:{messages:{handler:function(){var t=this;this.$nextTick((function(){t.scrollId=t.lastId}))},deep:!0,immediate:!0}},methods:{domId:function(t){return"msg-".concat(t.client_msg_id||t.id||Math.random())},formatTime:function(t){if(!t)return"";try{var e=String(t);return e.includes("T")?e.replace("T"," ").slice(0,16):e.slice(0,16)}catch(n){return""}}}};e.default=r},"5c14":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","toolbar card"),attrs:{_i:1}},[n("button",{staticClass:t._$s(2,"sc","btn-primary"),attrs:{_i:2},on:{click:t.goRequests}}),n("button",{attrs:{_i:3},on:{click:t.goSearch}}),n("button",{attrs:{_i:4},on:{click:t.goSettings}})]),t._$s(5,"i",!t.friends.length)?n("view",{staticClass:t._$s(5,"sc","empty"),attrs:{_i:5}}):n("view",{staticClass:t._$s(6,"sc","list"),attrs:{_i:6}},t._l(t._$s(7,"f",{forItems:t.friends}),(function(e,r,s,i){return n("view",{key:t._$s(7,"f",{forIndex:s,key:e.id}),staticClass:t._$s("7-"+i,"sc","friend-item card"),attrs:{_i:"7-"+i},on:{click:function(n){return t.openChat(e)}}},[n("avatar",{staticClass:t._$s("8-"+i,"sc","avatar"),attrs:{name:e.username,avatar:e.avatar,_i:"8-"+i}}),n("view",{staticClass:t._$s("9-"+i,"sc","center"),attrs:{_i:"9-"+i}},[n("view",{staticClass:t._$s("10-"+i,"sc","name"),attrs:{_i:"10-"+i}},[t._v(t._$s("10-"+i,"t0-0",t._s(e.username)))]),n("view",{staticClass:t._$s("11-"+i,"sc","text-sub"),attrs:{_i:"11-"+i}},[t._v(t._$s("11-"+i,"t0-0",t._s(e.id)))])]),t._$s("12-"+i,"i",t.unread(e.id))?n("view",{staticClass:t._$s("12-"+i,"sc","badge"),attrs:{_i:"12-"+i}},[t._v(t._$s("12-"+i,"t0-0",t._s(t.unread(e.id))))]):t._e()],1)})),0)])},s=[]},"60e9":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","title"),attrs:{_i:1}}),n("view",{staticClass:t._$s(2,"sc","card mt-24"),attrs:{_i:2}},[n("view",{staticClass:t._$s(3,"sc","field"),attrs:{_i:3}},[n("text",{staticClass:t._$s(4,"sc","label"),attrs:{_i:4}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],staticClass:t._$s(5,"sc","input"),attrs:{_i:5},domProps:{value:t._$s(5,"v-model",t.form.username)},on:{input:function(e){e.target.composing||t.$set(t.form,"username",e.target.value)}}})]),n("view",{staticClass:t._$s(6,"sc","field mt-24"),attrs:{_i:6}},[n("text",{staticClass:t._$s(7,"sc","label"),attrs:{_i:7}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],staticClass:t._$s(8,"sc","input"),attrs:{_i:8},domProps:{value:t._$s(8,"v-model",t.form.password)},on:{input:function(e){e.target.composing||t.$set(t.form,"password",e.target.value)}}})]),n("button",{staticClass:t._$s(9,"sc","btn mt-32"),attrs:{_i:9},on:{click:t.handleLogin}}),n("view",{staticClass:t._$s(10,"sc","text-sub mt-16"),attrs:{_i:10}},[n("text",{staticClass:t._$s(11,"sc","link"),attrs:{_i:11},on:{click:t.goRegister}})])])])},s=[]},"60f9":function(t,e,n){"use strict";n.r(e);var r=n("cc0c"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},6382:function(t,e,n){var r=n("6454");t.exports=function(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}},t.exports.__esModule=!0,t.exports["default"]=t.exports},"640f":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={methods:{open:function(t){uni.navigateTo({url:"/pages/common/webview?url=".concat(encodeURIComponent(t))})}}};e.default=r},6454:function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.__esModule=!0,t.exports["default"]=t.exports},"6b71":function(t,e,n){"use strict";n.r(e);var r=n("fd47"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"6eb0":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("c367")),o={methods:{open:function(t){uni.navigateTo({url:"/pages/common/webview?url=".concat(encodeURIComponent(t))})},contact:function(){uni.showModal({title:"\u8054\u7cfb\u5ba2\u670d",content:"\u90ae\u7bb1\uff1aexample@your.com",showCancel:!1})},confirmDelete:function(){var t=this;uni.showModal({title:"\u786e\u8ba4\u6ce8\u9500",content:"\u6ce8\u9500\u540e\u8d26\u53f7\u53ca\u76f8\u5173\u6570\u636e\u5c06\u88ab\u5904\u7406\uff0c\u64cd\u4f5c\u4e0d\u53ef\u6062\u590d\uff0c\u786e\u5b9a\u7ee7\u7eed\uff1f",success:function(){var e=(0,i.default)(s.default.mark((function e(n){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n.confirm){e.next=10;break}return e.prev=1,e.next=4,(0,a.default)({url:"/users/delete",method:"POST"});case 4:uni.showToast({title:"\u5df2\u63d0\u4ea4\u6ce8\u9500",icon:"success"}),t.$store.dispatch("auth/logout"),e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](1);case 10:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()})}}};e.default=o},"70f1":function(t,e,n){"use strict";n.r(e);var r=n("60e9"),s=n("ec46");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"1960367e",null,!1,r["a"],void 0);e["default"]=o.exports},7136:function(t,e,n){"use strict";n.r(e);var r=n("d07f"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"7ca3":function(t,e,n){var r=n("d551");t.exports=function(t,e,n){return e=r(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.__esModule=!0,t.exports["default"]=t.exports},8158:function(t,e,n){"use strict";n.r(e);var r=n("b886"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"828b":function(t,e,n){"use strict";function r(t,e,n,r,s,i,a,o,c,u){var f,l="function"===typeof t?t.options:t;if(c){l.components||(l.components={});var d=Object.prototype.hasOwnProperty;for(var p in c)d.call(c,p)&&!d.call(l.components,p)&&(l.components[p]=c[p])}if(u&&("function"===typeof u.beforeCreate&&(u.beforeCreate=[u.beforeCreate]),(u.beforeCreate||(u.beforeCreate=[])).unshift((function(){this[u.__module]=this})),(l.mixins||(l.mixins=[])).push(u)),e&&(l.render=e,l.staticRenderFns=n,l._compiled=!0),r&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),a?(f=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},l._ssrRegister=f):s&&(f=o?function(){s.call(this,this.$root.$options.shadowRoot)}:s),f)if(l.functional){l._injectStyles=f;var v=l.render;l.render=function(t,e){return f.call(e),v(t,e)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,f):[f]}return{exports:t,options:l}}n.d(e,"a",(function(){return r}))},8899:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=r(n("af34")),c=r(n("951c")),u=n("51b7"),f=n("2108");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var p=function(t,e){t.sessions[e]||c.default.set(t.sessions,e,{list:[],hasMore:!0,loading:!1})},v={setWsStatus:function(t,e){t.wsStatus=e},setActivePeerId:function(t,e){t.activePeerId=e,e&&c.default.set(t.unread,e,0)},setUnreadList:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};e.forEach((function(t){n[t.peer_user_id]=t.unread_count})),t.unread=n},setUnread:function(t,e){var n=e.peerId,r=e.count;c.default.set(t.unread,n,r)},setSessionLoading:function(t,e){var n=e.peerId,r=e.loading;p(t,n),t.sessions[n].loading=r},prependHistory:function(t,e){var n=e.peerId,r=e.messages,s=void 0===r?[]:r,i=e.hasMore,a=void 0===i||i;p(t,n);var c=t.sessions[n],u=s.slice().reverse().map((function(t){return h(t)}));c.list=[].concat((0,o.default)(u),(0,o.default)(c.list)),c.hasMore=a},addOrUpdateMessage:function(t,e){var n=e.peerId,r=e.message;p(t,n);var s=t.sessions[n],i=s.list.findIndex((function(t){return r.client_msg_id&&t.client_msg_id===r.client_msg_id||r.id&&t.id===r.id})),a=h(r);i>=0?c.default.set(s.list,i,d(d({},s.list[i]),a)):s.list.push(a)}},h=function(t){return{id:t.message_id||t.id||null,from_user_id:t.from_user_id||t.sender_id,to_user_id:t.to_user_id||t.receiver_id,content:t.content,content_type:t.content_type||"text",created_at:t.created_at||(new Date).toISOString(),client_msg_id:t.client_msg_id,status:t.status||"sent"}},m={syncUnread:function(t){return(0,i.default)(s.default.mark((function e(){var n,r;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,(0,u.fetchUnread)();case 3:r=e.sent,n("setUnreadList",r);case 5:case"end":return e.stop()}}),e)})))()},loadHistory:function(t,e){return(0,i.default)(s.default.mark((function n(){var r,i,a,o,c,f,l;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.commit,i=e.peerId,a=e.before,o=e.limit,c=void 0===o?20:o,r("setSessionLoading",{peerId:i,loading:!0}),n.prev=3,n.next=6,(0,u.fetchHistory)({peer_user_id:i,limit:c,before:a});case 6:f=n.sent,l=f.length>=c,r("prependHistory",{peerId:i,messages:f,hasMore:l});case 9:return n.prev=9,r("setSessionLoading",{peerId:i,loading:!1}),n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[3,,9,12]])})))()},sendMessage:function(t,e){return(0,i.default)(s.default.mark((function n(){var r,i,a,o,c,l,p,v,h,m,_;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.commit,i=t.rootState,a=t.state,o=e.peerId,c=e.content,l="".concat(Date.now(),"_").concat(Math.random().toString(16).slice(2,8)),p=i.auth.user||{},v=p.id||p.user_id,h={client_msg_id:l,from_user_id:v,to_user_id:o,content:c,content_type:"text",created_at:(new Date).toISOString(),status:"pending"},r("addOrUpdateMessage",{peerId:o,message:h}),m="open"===a.wsStatus,!m){n.next=19;break}n.prev=9,(0,f.sendMessage)({to:o,content:c,client_msg_id:l}),n.next=17;break;case 13:throw n.prev=13,n.t0=n["catch"](9),r("addOrUpdateMessage",{peerId:o,message:d(d({},h),{},{status:"failed"})}),n.t0;case 17:n.next=30;break;case 19:return n.prev=19,n.next=22,(0,u.sendMessageApi)({receiver_id:o,content:c});case 22:_=n.sent,r("addOrUpdateMessage",{peerId:o,message:d(d({},_),{},{client_msg_id:l,status:"sent"})}),n.next=30;break;case 26:throw n.prev=26,n.t1=n["catch"](19),r("addOrUpdateMessage",{peerId:o,message:d(d({},h),{},{status:"failed"})}),n.t1;case 30:case"end":return n.stop()}}),n,null,[[9,13],[19,26]])})))()},receiveIncoming:function(t,e){var n=t.commit,r=t.rootState,s=t.state,i=r.auth.user||{},a=i.id||i.user_id;if(a){var o=e.from_user_id===a?e.to_user_id:e.from_user_id;n("addOrUpdateMessage",{peerId:o,message:d(d({},e),{},{status:"sent"})}),s.activePeerId!==o&&n("setUnread",{peerId:o,count:(s.unread[o]||0)+(e.from_user_id===a?0:1)})}},clearUnread:function(t,e){var n=t.commit;e&&n("setUnread",{peerId:e,count:0})},setActivePeer:function(t,e){var n=t.commit;n("setActivePeerId",e)}},_={namespaced:!0,state:function(){return{sessions:{},unread:{},activePeerId:null,wsStatus:"closed"}},getters:{sessionMessages:function(t){return function(e){var n=t.sessions[e];return n?n.list:[]}},unreadCount:function(t){return function(e){return t.unread[e]||0}}},mutations:v,actions:m};e.default=_},"89fe":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={props:{name:{type:String,default:""},avatar:{type:String,default:""},size:{type:Number,default:80}},computed:{initials:function(){return this.name?this.name.trim().charAt(0).toUpperCase():"U"},bgStyle:function(){var t="".concat(this.size,"rpx");return{width:t,height:t}}}};e.default=r},"8cc6":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("7ca3")),i=n("8f59"),a=r(n("e5cf"));function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){(0,s.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var u={components:{Avatar:a.default},computed:c({},(0,i.mapState)("auth",["user"])),methods:c(c({},(0,i.mapActions)("auth",["logout"])),{},{open:function(t){uni.navigateTo({url:t})}})};e.default=u},"8dca":function(t,e,n){"use strict";n.r(e);var r=n("8cc6"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"8f3c":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("8f59"),c=r(n("25b1")),u=r(n("08aa"));function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={components:{MessageList:c.default,MessageInput:u.default},data:function(){return{peerId:null,peerName:""}},computed:l(l(l({},(0,o.mapState)("messages",["sessions"])),(0,o.mapState)("auth",["user"])),{},{session:function(){return this.sessions[this.peerId]||{list:[],hasMore:!0,loading:!1}},messages:function(){return this.session.list},selfId:function(){return this.user?this.user.id||this.user.user_id:null}}),onLoad:function(t){this.peerId=Number(t.peerId||t.peer_id),this.peerName=t.name?decodeURIComponent(t.name):"",this.peerName&&uni.setNavigationBarTitle({title:this.peerName})},onShow:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.enter();case 2:case"end":return e.stop()}}),e)})))()},onUnload:function(){this.setActivePeer(null)},methods:l(l({},(0,o.mapActions)("messages",["loadHistory","sendMessage","setActivePeer","clearUnread"])),{},{enter:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.peerId){e.next=4;break}return uni.showToast({title:"\u7f3a\u5c11\u4f1a\u8bdd",icon:"none"}),uni.navigateBack(),e.abrupt("return");case 4:return e.next=6,t.setActivePeer(t.peerId);case 6:return e.next=8,t.clearUnread(t.peerId);case 8:if(t.messages.length){e.next=11;break}return e.next=11,t.loadHistory({peerId:t.peerId,limit:20});case 11:case"end":return e.stop()}}),e)})))()},loadMore:function(){var t=this;return(0,i.default)(s.default.mark((function e(){var n;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.session.loading&&t.session.hasMore&&t.messages.length){e.next=2;break}return e.abrupt("return");case 2:return n=t.messages[0],e.next=5,t.loadHistory({peerId:t.peerId,before:n.created_at,limit:20});case 5:case"end":return e.stop()}}),e)})))()},send:function(t){var e=this;return(0,i.default)(s.default.mark((function n(){return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.sendMessage({peerId:e.peerId,content:t});case 2:case"end":return n.stop()}}),n)})))()}})};e.default=d},"8f59":function(t,e,n){"use strict";(function(e){var n="undefined"!==typeof window?window:"undefined"!==typeof e?e:{},r=n.__VUE_DEVTOOLS_GLOBAL_HOOK__;function s(t,e){if(void 0===e&&(e=[]),null===t||"object"!==typeof t)return t;var n=function(t,e){return t.filter(e)[0]}(e,(function(e){return e.original===t}));if(n)return n.copy;var r=Array.isArray(t)?[]:{};return e.push({original:t,copy:r}),Object.keys(t).forEach((function(n){r[n]=s(t[n],e)})),r}function i(t,e){Object.keys(t).forEach((function(n){return e(t[n],n)}))}function a(t){return null!==t&&"object"===typeof t}var o=function(t,e){this.runtime=e,this._children=Object.create(null),this._rawModule=t;var n=t.state;this.state=("function"===typeof n?n():n)||{}},c={namespaced:{configurable:!0}};c.namespaced.get=function(){return!!this._rawModule.namespaced},o.prototype.addChild=function(t,e){this._children[t]=e},o.prototype.removeChild=function(t){delete this._children[t]},o.prototype.getChild=function(t){return this._children[t]},o.prototype.hasChild=function(t){return t in this._children},o.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},o.prototype.forEachChild=function(t){i(this._children,t)},o.prototype.forEachGetter=function(t){this._rawModule.getters&&i(this._rawModule.getters,t)},o.prototype.forEachAction=function(t){this._rawModule.actions&&i(this._rawModule.actions,t)},o.prototype.forEachMutation=function(t){this._rawModule.mutations&&i(this._rawModule.mutations,t)},Object.defineProperties(o.prototype,c);var u=function(t){this.register([],t,!1)};u.prototype.get=function(t){return t.reduce((function(t,e){return t.getChild(e)}),this.root)},u.prototype.getNamespace=function(t){var e=this.root;return t.reduce((function(t,n){return e=e.getChild(n),t+(e.namespaced?n+"/":"")}),"")},u.prototype.update=function(t){(function t(e,n,r){0;if(n.update(r),r.modules)for(var s in r.modules){if(!n.getChild(s))return void 0;t(e.concat(s),n.getChild(s),r.modules[s])}})([],this.root,t)},u.prototype.register=function(t,e,n){var r=this;void 0===n&&(n=!0);var s=new o(e,n);if(0===t.length)this.root=s;else{var a=this.get(t.slice(0,-1));a.addChild(t[t.length-1],s)}e.modules&&i(e.modules,(function(e,s){r.register(t.concat(s),e,n)}))},u.prototype.unregister=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1],r=e.getChild(n);r&&r.runtime&&e.removeChild(n)},u.prototype.isRegistered=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1];return!!e&&e.hasChild(n)};var f;var l=function(t){var e=this;void 0===t&&(t={}),!f&&"undefined"!==typeof window&&window.Vue&&b(window.Vue);var n=t.plugins;void 0===n&&(n=[]);var s=t.strict;void 0===s&&(s=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new u(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new f,this._makeLocalGettersCache=Object.create(null);var i=this,a=this.dispatch,o=this.commit;this.dispatch=function(t,e){return a.call(i,t,e)},this.commit=function(t,e,n){return o.call(i,t,e,n)},this.strict=s;var c=this._modules.root.state;m(this,c,[],this._modules.root),h(this,c),n.forEach((function(t){return t(e)}));var l=void 0!==t.devtools?t.devtools:f.config.devtools;l&&function(t){r&&(t._devtoolHook=r,r.emit("vuex:init",t),r.on("vuex:travel-to-state",(function(e){t.replaceState(e)})),t.subscribe((function(t,e){r.emit("vuex:mutation",t,e)}),{prepend:!0}),t.subscribeAction((function(t,e){r.emit("vuex:action",t,e)}),{prepend:!0}))}(this)},d={state:{configurable:!0}};function p(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var n=e.indexOf(t);n>-1&&e.splice(n,1)}}function v(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;m(t,n,[],t._modules.root,!0),h(t,n,e)}function h(t,e,n){var r=t._vm;t.getters={},t._makeLocalGettersCache=Object.create(null);var s=t._wrappedGetters,a={};i(s,(function(e,n){a[n]=function(t,e){return function(){return t(e)}}(e,t),Object.defineProperty(t.getters,n,{get:function(){return t._vm[n]},enumerable:!0})}));var o=f.config.silent;f.config.silent=!0,t._vm=new f({data:{$$state:e},computed:a}),f.config.silent=o,t.strict&&function(t){t._vm.$watch((function(){return this._data.$$state}),(function(){0}),{deep:!0,sync:!0})}(t),r&&(n&&t._withCommit((function(){r._data.$$state=null})),f.nextTick((function(){return r.$destroy()})))}function m(t,e,n,r,s){var i=!n.length,a=t._modules.getNamespace(n);if(r.namespaced&&(t._modulesNamespaceMap[a],t._modulesNamespaceMap[a]=r),!i&&!s){var o=_(e,n.slice(0,-1)),c=n[n.length-1];t._withCommit((function(){f.set(o,c,r.state)}))}var u=r.context=function(t,e,n){var r=""===e,s={dispatch:r?t.dispatch:function(n,r,s){var i=g(n,r,s),a=i.payload,o=i.options,c=i.type;return o&&o.root||(c=e+c),t.dispatch(c,a)},commit:r?t.commit:function(n,r,s){var i=g(n,r,s),a=i.payload,o=i.options,c=i.type;o&&o.root||(c=e+c),t.commit(c,a,o)}};return Object.defineProperties(s,{getters:{get:r?function(){return t.getters}:function(){return function(t,e){if(!t._makeLocalGettersCache[e]){var n={},r=e.length;Object.keys(t.getters).forEach((function(s){if(s.slice(0,r)===e){var i=s.slice(r);Object.defineProperty(n,i,{get:function(){return t.getters[s]},enumerable:!0})}})),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}(t,e)}},state:{get:function(){return _(t.state,n)}}}),s}(t,a,n);r.forEachMutation((function(e,n){var r=a+n;(function(t,e,n,r){var s=t._mutations[e]||(t._mutations[e]=[]);s.push((function(e){n.call(t,r.state,e)}))})(t,r,e,u)})),r.forEachAction((function(e,n){var r=e.root?n:a+n,s=e.handler||e;(function(t,e,n,r){var s=t._actions[e]||(t._actions[e]=[]);s.push((function(e){var s=n.call(t,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:t.getters,rootState:t.state},e);return function(t){return t&&"function"===typeof t.then}(s)||(s=Promise.resolve(s)),t._devtoolHook?s.catch((function(e){throw t._devtoolHook.emit("vuex:error",e),e})):s}))})(t,r,s,u)})),r.forEachGetter((function(e,n){var r=a+n;(function(t,e,n,r){if(t._wrappedGetters[e])return void 0;t._wrappedGetters[e]=function(t){return n(r.state,r.getters,t.state,t.getters)}})(t,r,e,u)})),r.forEachChild((function(r,i){m(t,e,n.concat(i),r,s)}))}function _(t,e){return e.reduce((function(t,e){return t[e]}),t)}function g(t,e,n){return a(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}function b(t){f&&t===f||(f=t,
/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */
function(t){var e=Number(t.version.split(".")[0]);if(e>=2)t.mixin({beforeCreate:r});else{var n=t.prototype._init;t.prototype._init=function(t){void 0===t&&(t={}),t.init=t.init?[r].concat(t.init):r,n.call(this,t)}}function r(){var t=this.$options;t.store?this.$store="function"===typeof t.store?t.store():t.store:t.parent&&t.parent.$store&&(this.$store=t.parent.$store)}}(f))}d.state.get=function(){return this._vm._data.$$state},d.state.set=function(t){0},l.prototype.commit=function(t,e,n){var r=this,s=g(t,e,n),i=s.type,a=s.payload,o=(s.options,{type:i,payload:a}),c=this._mutations[i];c&&(this._withCommit((function(){c.forEach((function(t){t(a)}))})),this._subscribers.slice().forEach((function(t){return t(o,r.state)})))},l.prototype.dispatch=function(t,e){var n=this,r=g(t,e),s=r.type,i=r.payload,a={type:s,payload:i},o=this._actions[s];if(o){try{this._actionSubscribers.slice().filter((function(t){return t.before})).forEach((function(t){return t.before(a,n.state)}))}catch(u){0}var c=o.length>1?Promise.all(o.map((function(t){return t(i)}))):o[0](i);return new Promise((function(t,e){c.then((function(e){try{n._actionSubscribers.filter((function(t){return t.after})).forEach((function(t){return t.after(a,n.state)}))}catch(u){0}t(e)}),(function(t){try{n._actionSubscribers.filter((function(t){return t.error})).forEach((function(e){return e.error(a,n.state,t)}))}catch(u){0}e(t)}))}))}},l.prototype.subscribe=function(t,e){return p(t,this._subscribers,e)},l.prototype.subscribeAction=function(t,e){var n="function"===typeof t?{before:t}:t;return p(n,this._actionSubscribers,e)},l.prototype.watch=function(t,e,n){var r=this;return this._watcherVM.$watch((function(){return t(r.state,r.getters)}),e,n)},l.prototype.replaceState=function(t){var e=this;this._withCommit((function(){e._vm._data.$$state=t}))},l.prototype.registerModule=function(t,e,n){void 0===n&&(n={}),"string"===typeof t&&(t=[t]),this._modules.register(t,e),m(this,this.state,t,this._modules.get(t),n.preserveState),h(this,this.state)},l.prototype.unregisterModule=function(t){var e=this;"string"===typeof t&&(t=[t]),this._modules.unregister(t),this._withCommit((function(){var n=_(e.state,t.slice(0,-1));f.delete(n,t[t.length-1])})),v(this)},l.prototype.hasModule=function(t){return"string"===typeof t&&(t=[t]),this._modules.isRegistered(t)},l.prototype[[104,111,116,85,112,100,97,116,101].map((function(t){return String.fromCharCode(t)})).join("")]=function(t){this._modules.update(t),v(this,!0)},l.prototype._withCommit=function(t){var e=this._committing;this._committing=!0,t(),this._committing=e},Object.defineProperties(l.prototype,d);var y=j((function(t,e){var n={};return $(e).forEach((function(e){var r=e.key,s=e.val;n[r]=function(){var e=this.$store.state,n=this.$store.getters;if(t){var r=C(this.$store,"mapState",t);if(!r)return;e=r.context.state,n=r.context.getters}return"function"===typeof s?s.call(this,e,n):e[s]},n[r].vuex=!0})),n})),w=j((function(t,e){var n={};return $(e).forEach((function(e){var r=e.key,s=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.commit;if(t){var i=C(this.$store,"mapMutations",t);if(!i)return;r=i.context.commit}return"function"===typeof s?s.apply(this,[r].concat(e)):r.apply(this.$store,[s].concat(e))}})),n})),O=j((function(t,e){var n={};return $(e).forEach((function(e){var r=e.key,s=e.val;s=t+s,n[r]=function(){if(!t||C(this.$store,"mapGetters",t))return this.$store.getters[s]},n[r].vuex=!0})),n})),x=j((function(t,e){var n={};return $(e).forEach((function(e){var r=e.key,s=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.dispatch;if(t){var i=C(this.$store,"mapActions",t);if(!i)return;r=i.context.dispatch}return"function"===typeof s?s.apply(this,[r].concat(e)):r.apply(this.$store,[s].concat(e))}})),n}));function $(t){return function(t){return Array.isArray(t)||a(t)}(t)?Array.isArray(t)?t.map((function(t){return{key:t,val:t}})):Object.keys(t).map((function(e){return{key:e,val:t[e]}})):[]}function j(t){return function(e,n){return"string"!==typeof e?(n=e,e=""):"/"!==e.charAt(e.length-1)&&(e+="/"),t(e,n)}}function C(t,e,n){var r=t._modulesNamespaceMap[n];return r}function P(t,e,n){var r=n?t.groupCollapsed:t.group;try{r.call(t,e)}catch(s){t.log(e)}}function S(t){try{t.groupEnd()}catch(e){t.log("\u2014\u2014 log end \u2014\u2014")}}function k(){var t=new Date;return" @ "+E(t.getHours(),2)+":"+E(t.getMinutes(),2)+":"+E(t.getSeconds(),2)+"."+E(t.getMilliseconds(),3)}function E(t,e){return function(t,e){return new Array(e+1).join(t)}("0",e-t.toString().length)+t}var M={Store:l,install:b,version:"3.6.2",mapState:y,mapMutations:w,mapGetters:O,mapActions:x,createNamespacedHelpers:function(t){return{mapState:y.bind(null,t),mapGetters:O.bind(null,t),mapMutations:w.bind(null,t),mapActions:x.bind(null,t)}},createLogger:function(t){void 0===t&&(t={});var e=t.collapsed;void 0===e&&(e=!0);var n=t.filter;void 0===n&&(n=function(t,e,n){return!0});var r=t.transformer;void 0===r&&(r=function(t){return t});var i=t.mutationTransformer;void 0===i&&(i=function(t){return t});var a=t.actionFilter;void 0===a&&(a=function(t,e){return!0});var o=t.actionTransformer;void 0===o&&(o=function(t){return t});var c=t.logMutations;void 0===c&&(c=!0);var u=t.logActions;void 0===u&&(u=!0);var f=t.logger;return void 0===f&&(f=console),function(t){var l=s(t.state);"undefined"!==typeof f&&(c&&t.subscribe((function(t,a){var o=s(a);if(n(t,l,o)){var c=k(),u=i(t),d="mutation "+t.type+c;P(f,d,e),f.log("%c prev state","color: #9E9E9E; font-weight: bold",r(l)),f.log("%c mutation","color: #03A9F4; font-weight: bold",u),f.log("%c next state","color: #4CAF50; font-weight: bold",r(o)),S(f)}l=o})),u&&t.subscribeAction((function(t,n){if(a(t,n)){var r=k(),s=o(t),i="action "+t.type+r;P(f,i,e),f.log("%c action","color: #03A9F4; font-weight: bold",s),S(f)}})))}}};t.exports=M}).call(this,n("0ee4"))},"8f5b":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("scroll-view",{staticClass:t._$s(0,"sc","message-list"),attrs:{"scroll-into-view":t._$s(0,"a-scroll-into-view",t.scrollId),_i:0},on:{scrolltoupper:function(e){return t.$emit("loadMore")}}},[n("view",{attrs:{id:"top-anchor",_i:1}}),t._l(t._$s(2,"f",{forItems:t.messages}),(function(e,r,s,i){return n("view",{key:t._$s(2,"f",{forIndex:s,key:e.client_msg_id||e.id}),staticClass:t._$s("2-"+i,"sc","row"),attrs:{id:t._$s("2-"+i,"a-id",t.domId(e)),_i:"2-"+i}},[n("view",{staticClass:t._$s("3-"+i,"sc","bubble-wrap"),class:t._$s("3-"+i,"c",e.from_user_id===t.currentUserId?"self":"peer"),attrs:{_i:"3-"+i}},[n("view",{staticClass:t._$s("4-"+i,"sc","bubble"),class:t._$s("4-"+i,"c",e.from_user_id===t.currentUserId?"bubble-self":"bubble-peer"),attrs:{_i:"4-"+i}},[t._$s("5-"+i,"i","text"===e.content_type)?n("view",{attrs:{_i:"5-"+i}},[t._v(t._$s("5-"+i,"t0-0",t._s(e.content)))]):n("view",{staticClass:t._$s("6-"+i,"sc","placeholder"),attrs:{_i:"6-"+i}},[t._v(t._$s("6-"+i,"t0-0",t._s(e.content_type)))]),t._$s("7-"+i,"i","pending"===e.status)?n("view",{staticClass:t._$s("7-"+i,"sc","status"),attrs:{_i:"7-"+i}}):t._$s("8-"+i,"e","failed"===e.status)?n("view",{staticClass:t._$s("8-"+i,"sc","status status-error"),attrs:{_i:"8-"+i}}):t._e()]),n("view",{staticClass:t._$s("9-"+i,"sc","time"),attrs:{_i:"9-"+i}},[t._v(t._$s("9-"+i,"t0-0",t._s(t.formatTime(e.created_at))))])])])})),n("view",{attrs:{id:"bottom-anchor",_i:10}})],2)},s=[]},9008:function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports["default"]=t.exports},"945f":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("8f59"),c=r(n("e5cf"));function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={components:{Avatar:c.default},computed:f(f(f({},(0,o.mapState)("friends",["list"])),(0,o.mapGetters)("messages",["unreadCount"])),{},{friends:function(){return this.list||[]}}),onShow:function(){this.init()},methods:f(f({},(0,o.mapActions)("friends",["loadFriends"])),{},{unread:function(t){return this.unreadCount(t)},init:function(){var t=this;return(0,i.default)(s.default.mark((function e(){var n;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$store.getters["auth/isAuthed"],n){e.next=4;break}return uni.reLaunch({url:"/pages/auth/login"}),e.abrupt("return");case 4:return e.next=6,t.loadFriends();case 6:case"end":return e.stop()}}),e)})))()},goRequests:function(){uni.navigateTo({url:"/pages/friend/requests"})},goSearch:function(){uni.navigateTo({url:"/pages/friend/search"})},goSettings:function(){uni.navigateTo({url:"/pages/settings/privacy"})},openChat:function(t){uni.navigateTo({url:"/pages/chat/session?peerId=".concat(t.id,"&name=").concat(encodeURIComponent(t.username))})}})};e.default=l},"951c":function(t,e){t.exports=Vue},"9afa":function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticClass:this._$s(0,"sc","chat-page"),attrs:{_i:0}},[e("message-list",{attrs:{messages:this.messages,currentUserId:this.selfId,_i:1},on:{loadMore:this.loadMore}}),e("message-input",{attrs:{_i:2},on:{send:this.send}})],1)},s=[]},"9dea":function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("8f59");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={computed:u({},(0,o.mapState)("friends",["incoming","outgoing"])),onShow:function(){this.load()},methods:u(u({},(0,o.mapActions)("friends",["loadRequests","handleRequest","loadFriends"])),{},{load:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.loadRequests();case 2:case"end":return e.stop()}}),e)})))()},accept:function(t){var e=this;return(0,i.default)(s.default.mark((function n(){return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleRequest({id:t,action:"accept"});case 2:return n.next=4,e.loadFriends();case 4:uni.showToast({title:"\u5df2\u63a5\u53d7",icon:"success"});case 5:case"end":return n.stop()}}),n)})))()},reject:function(t){var e=this;return(0,i.default)(s.default.mark((function n(){return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleRequest({id:t,action:"reject"});case 2:uni.showToast({title:"\u5df2\u62d2\u7edd",icon:"none"});case 3:case"end":return n.stop()}}),n)})))()}})};e.default=f},"9fc1":function(t,e,n){var r=n("3b2d")["default"];function s(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t.exports=s=function(){return n},t.exports.__esModule=!0,t.exports["default"]=t.exports;var e,n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",f=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function d(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(e){d=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var s=e&&e.prototype instanceof b?e:b,i=Object.create(s.prototype),a=new I(r||[]);return o(i,"_invoke",{value:S(t,n,a)}),i}function v(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=p;var h="suspendedStart",m="executing",_="completed",g={};function b(){}function y(){}function w(){}var O={};d(O,u,(function(){return this}));var x=Object.getPrototypeOf,$=x&&x(x(A([])));$&&$!==i&&a.call($,u)&&(O=$);var j=w.prototype=b.prototype=Object.create(O);function C(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(s,i,o,c){var u=v(t[s],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==r(l)&&a.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,c)}),(function(t){n("throw",t,o,c)})):e.resolve(l).then((function(t){f.value=t,o(f)}),(function(t){return n("throw",t,o,c)}))}c(u.arg)}var s;o(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,s){n(t,r,e,s)}))}return s=s?s.then(i,i):i()}})}function S(t,n,r){var s=h;return function(i,a){if(s===m)throw Error("Generator is already running");if(s===_){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var c=k(o,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(s===h)throw s=_,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s=m;var u=v(t,n,r);if("normal"===u.type){if(s=r.done?_:"suspendedYield",u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(s=_,r.method="throw",r.arg=u.arg)}}}function k(t,n){var r=n.method,s=t.iterator[r];if(s===e)return n.delegate=null,"throw"===r&&t.iterator["return"]&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=v(s,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var s=-1,i=function n(){for(;++s<t.length;)if(a.call(t,s))return n.value=t[s],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(r(t)+" is not iterable")}return y.prototype=w,o(j,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:y,configurable:!0}),y.displayName=d(w,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,d(t,l,"GeneratorFunction")),t.prototype=Object.create(j),t},n.awrap=function(t){return{__await:t}},C(P.prototype),d(P.prototype,f,(function(){return this})),n.AsyncIterator=P,n.async=function(t,e,r,s,i){void 0===i&&(i=Promise);var a=new P(p(t,e,r,s),i);return n.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(j),d(j,l,"Generator"),d(j,u,(function(){return this})),d(j,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=A,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,s){return o.type="throw",o.arg=t,n.next=r,s&&(n.method="next",n.arg=e),!!s}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=t,i.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),M(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var s=r.arg;M(n)}return s}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},n}t.exports=s,t.exports.__esModule=!0,t.exports["default"]=t.exports},a708:function(t,e,n){var r=n("6454");t.exports=function(t){if(Array.isArray(t))return r(t)},t.exports.__esModule=!0,t.exports["default"]=t.exports},ab93:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","card header"),attrs:{_i:1}},[n("avatar",{attrs:{name:t.user&&t.user.username,avatar:t.user&&t.user.avatar,size:120,_i:2}}),n("view",{staticClass:t._$s(3,"sc","info"),attrs:{_i:3}},[n("view",{staticClass:t._$s(4,"sc","name"),attrs:{_i:4}},[t._v(t._$s(4,"t0-0",t._s(t.user&&t.user.username)))]),n("view",{staticClass:t._$s(5,"sc","text-sub"),attrs:{_i:5}},[t._v(t._$s(5,"t0-0",t._s(t.user&&t.user.id)))])])],1),n("view",{staticClass:t._$s(6,"sc","card item"),attrs:{_i:6},on:{click:function(e){return t.open("/pages/settings/about")}}},[n("text")]),n("view",{staticClass:t._$s(8,"sc","card item"),attrs:{_i:8},on:{click:function(e){return t.open("/pages/settings/privacy")}}},[n("text")]),n("view",{staticClass:t._$s(10,"sc","card item danger"),attrs:{_i:10},on:{click:t.logout}},[n("text")])])},s=[]},af34:function(t,e,n){var r=n("a708"),s=n("b893"),i=n("6382"),a=n("9008");t.exports=function(t){return r(t)||s(t)||i(t)||a()},t.exports.__esModule=!0,t.exports["default"]=t.exports},b0ad:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","card item"),attrs:{_i:1},on:{click:function(e){return t.open("/static/privacy.html")}}},[n("text")]),n("view",{staticClass:t._$s(3,"sc","card item"),attrs:{_i:3},on:{click:function(e){return t.open("/static/terms.html")}}},[n("text")])])},s=[]},b586:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={data:function(){return{content:"",showEmoji:!1,emojis:["\ud83d\ude00","\ud83d\ude01","\ud83d\ude02","\ud83e\udd23","\ud83d\ude0a","\ud83d\ude0d","\ud83d\ude18","\ud83d\ude0e","\ud83e\udd14","\ud83d\ude22","\ud83d\ude2d","\ud83d\ude21","\ud83d\udc4d","\ud83d\ude4f","\ud83c\udf89"]}},methods:{toggleEmoji:function(){this.showEmoji=!this.showEmoji},appendEmoji:function(t){this.content+=t},onSend:function(){var t=this.content.trim();t?(this.$emit("send",t),this.content="",this.showEmoji=!1):uni.showToast({title:"\u8bf7\u8f93\u5165\u5185\u5bb9",icon:"none"})}}};e.default=r},b886:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("51b7"),c=n("8f59");function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var l={data:function(){return{keyword:"",results:[]}},methods:f(f({},(0,c.mapActions)("friends",["sendRequest"])),{},{doSearch:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.keyword.trim()){e.next=3;break}return uni.showToast({title:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57",icon:"none"}),e.abrupt("return");case 3:return e.next=5,(0,o.searchUsers)(t.keyword.trim());case 5:t.results=e.sent;case 6:case"end":return e.stop()}}),e)})))()},addFriend:function(t){var e=this;return(0,i.default)(s.default.mark((function n(){return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.sendRequest(t);case 2:case"end":return n.stop()}}),n)})))()}})};e.default=l},b893:function(t,e){t.exports=function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports["default"]=t.exports},c30a:function(t,e,n){"use strict";n.r(e);var r=n("945f"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},c367:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n("fde0"),s=function(t){var e=uni.getStorageSync("privacy_agreed_version");if(!e)return uni.showToast({title:"\u8bf7\u5148\u9605\u8bfb\u5e76\u540c\u610f\u9690\u79c1\u653f\u7b56",icon:"none"}),Promise.reject({code:499,message:"privacy not agreed"});var n=uni.getStorageSync(r.storageKeys.token),s=t.header||{};return n&&(s["Authorization"]="Bearer ".concat(n)),new Promise((function(e,n){uni.request({url:"".concat(r.config.baseURL).concat(t.url),method:t.method||"GET",data:t.data||{},header:s,timeout:r.config.timeout,success:function(t){var s,i=t.data||{},a=null!==(s=i.code)&&void 0!==s?s:t.statusCode;if(401===t.statusCode||401===a)return uni.removeStorageSync(r.storageKeys.token),uni.removeStorageSync(r.storageKeys.user),uni.showToast({title:"\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55",icon:"none"}),setTimeout((function(){uni.reLaunch({url:"/pages/auth/login"})}),500),void n(i);0!==a?n(i):e(i.data)},fail:function(t){n({code:-1,message:t.errMsg||"\u7f51\u7edc\u5f02\u5e38"})}})})).catch((function(t){throw function(t){var e=(null===t||void 0===t?void 0:t.message)||"\u8bf7\u6c42\u5931\u8d25";uni.showToast({title:e,icon:"none"})}(t),t}))};e.default=s},c790:function(t,e,n){"use strict";n.r(e);var r=n("b586"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},c8bb:function(t,e,n){"use strict";n.r(e);var r=n("1f07"),s=n("6b71");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"2c3bbc55",null,!1,r["a"],void 0);e["default"]=o.exports},c94a:function(t,e,n){"use strict";n.r(e);var r=n("dade"),s=n("8158");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"04056caf",null,!1,r["a"],void 0);e["default"]=o.exports},cb0c:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("8f59");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={data:function(){return{form:{username:"",password:""},loading:!1}},methods:u(u({},(0,o.mapActions)("auth",["register"])),{},{handleRegister:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.form.username&&t.form.password){e.next=3;break}return uni.showToast({title:"\u8bf7\u586b\u5199\u5b8c\u6574",icon:"none"}),e.abrupt("return");case 3:return t.loading=!0,e.prev=4,e.next=7,t.register(t.form);case 7:uni.showToast({title:"\u6ce8\u518c\u5e76\u767b\u5f55\u6210\u529f",icon:"success"}),uni.reLaunch({url:"/pages/im/index"});case 9:return e.prev=9,t.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[4,,9,12]])})))()},goLogin:function(){uni.navigateBack({delta:1})}})};e.default=f},cc0c:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={data:function(){return{src:""}},onLoad:function(t){var e=t.url?decodeURIComponent(t.url):"";this.src=e}};e.default=r},cc86:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","card item"),attrs:{_i:1},on:{click:function(e){return t.open("/static/pi-list.html")}}},[n("text")]),n("view",{staticClass:t._$s(3,"sc","card item"),attrs:{_i:3},on:{click:function(e){return t.open("/static/third-parties.html")}}},[n("text")]),n("view",{staticClass:t._$s(5,"sc","card item"),attrs:{_i:5},on:{click:t.contact}},[n("text")]),n("view",{staticClass:t._$s(7,"sc","card item danger"),attrs:{_i:7},on:{click:t.confirmDelete}},[n("text")])])},s=[]},ce6a:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=n("51b7"),o={loadFriends:function(t){return(0,i.default)(s.default.mark((function e(){var n,r;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,n("setLoading",!0),e.prev=2,e.next=5,(0,a.fetchFriends)();case 5:r=e.sent,n("setList",r);case 7:return e.prev=7,n("setLoading",!1),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[2,,7,10]])})))()},loadRequests:function(t){return(0,i.default)(s.default.mark((function e(){var n,r,i;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,(0,a.fetchFriendRequests)("incoming");case 3:return r=e.sent,e.next=6,(0,a.fetchFriendRequests)("outgoing");case 6:i=e.sent,n("setIncoming",r),n("setOutgoing",i);case 9:case"end":return e.stop()}}),e)})))()},sendRequest:function(t,e){return(0,i.default)(s.default.mark((function t(){return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,a.sendFriendRequest)(e);case 2:uni.showToast({title:"\u8bf7\u6c42\u5df2\u53d1\u9001",icon:"success"});case 3:case"end":return t.stop()}}),t)})))()},handleRequest:function(t,e){return(0,i.default)(s.default.mark((function n(){var r,i,o;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.dispatch,i=e.id,o=e.action,n.next=4,(0,a.handleFriendRequest)(i,o);case 4:return n.next=6,r("loadRequests");case 6:if("accept"!==o){n.next=9;break}return n.next=9,r("loadFriends");case 9:case"end":return n.stop()}}),n)})))()}},c={namespaced:!0,state:function(){return{list:[],incoming:[],outgoing:[],loading:!1}},mutations:{setList:function(t,e){t.list=e||[]},setIncoming:function(t,e){t.incoming=e||[]},setOutgoing:function(t,e){t.outgoing=e||[]},setLoading:function(t,e){t.loading=e}},actions:o};e.default=c},d07f:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={onLaunch:function(){t("log","App Launch"," at App.vue:6");var e=uni.getStorageSync("privacy_agreed_version");"1.0"!==e&&uni.showModal({title:"\u9690\u79c1\u653f\u7b56\u63d0\u793a",content:"\u6211\u4eec\u4f1a\u6839\u636e\u9690\u79c1\u653f\u7b56\u6536\u96c6\u548c\u4f7f\u7528\u5fc5\u8981\u4fe1\u606f\u4ee5\u63d0\u4f9b\u5373\u65f6\u901a\u8baf\u670d\u52a1\uff0c\u8bf7\u60a8\u9605\u8bfb\u5e76\u540c\u610f\u300a\u9690\u79c1\u653f\u7b56\u300b\u548c\u300a\u7528\u6237\u534f\u8bae\u300b\u3002",confirmText:"\u540c\u610f\u5e76\u7ee7\u7eed",cancelText:"\u4e0d\u540c\u610f",success:function(t){t.confirm?uni.setStorageSync("privacy_agreed_version","1.0"):plus.runtime.quit()}})},onShow:function(){t("log","App Show"," at App.vue:32")},onHide:function(){t("log","App Hide"," at App.vue:35")}};e.default=n}).call(this,n("f3b9")["default"])},d1ca:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","avatar"),style:t._$s(0,"s",t.bgStyle),attrs:{_i:0}},[t._$s(1,"i",t.avatar)?n("image",{staticClass:t._$s(1,"sc","img"),attrs:{src:t._$s(1,"a-src",t.avatar),_i:1}}):n("text",{staticClass:t._$s(2,"sc","text"),attrs:{_i:2}},[t._v(t._$s(2,"t0-0",t._s(t.initials)))])])},s=[]},d551:function(t,e,n){var r=n("3b2d")["default"],s=n("e6db");t.exports=function(t){var e=s(t,"string");return"symbol"==r(e)?e:e+""},t.exports.__esModule=!0,t.exports["default"]=t.exports},d6d9:function(t,e,n){"use strict";n.r(e);var r=n("5c14"),s=n("c30a");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"74534d35",null,!1,r["a"],void 0);e["default"]=o.exports},d997:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("951c")),i=r(n("8f59")),a=r(n("44d7")),o=r(n("ce6a")),c=r(n("8899"));s.default.use(i.default);var u=new i.default.Store({modules:{auth:a.default,friends:o.default,messages:c.default}}),f=u;e.default=f},da75:function(t,e,n){"use strict";n.r(e);var r=n("b0ad"),s=n("575c");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"b917b900",null,!1,r["a"],void 0);e["default"]=o.exports},dade:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){}));var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:t._$s(0,"sc","container"),attrs:{_i:0}},[n("view",{staticClass:t._$s(1,"sc","card"),attrs:{_i:1}},[n("view",{staticClass:t._$s(2,"sc","field"),attrs:{_i:2}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:t._$s(3,"sc","input"),attrs:{_i:3},domProps:{value:t._$s(3,"v-model",t.keyword)},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}})]),n("button",{staticClass:t._$s(4,"sc","btn mt-16"),attrs:{_i:4},on:{click:t.doSearch}})]),t._$s(5,"i",t.results.length)?n("view",{staticClass:t._$s(5,"sc","list mt-24"),attrs:{_i:5}},t._l(t._$s(6,"f",{forItems:t.results}),(function(e,r,s,i){return n("view",{key:t._$s(6,"f",{forIndex:s,key:e.id}),staticClass:t._$s("6-"+i,"sc","card result"),attrs:{_i:"6-"+i}},[n("view",[n("view",{staticClass:t._$s("8-"+i,"sc","name"),attrs:{_i:"8-"+i}},[t._v(t._$s("8-"+i,"t0-0",t._s(e.username)))]),n("view",{staticClass:t._$s("9-"+i,"sc","text-sub"),attrs:{_i:"9-"+i}},[t._v(t._$s("9-"+i,"t0-0",t._s(e.id)))])]),n("button",{attrs:{_i:"10-"+i},on:{click:function(n){return t.addFriend(e.id)}}})])})),0):n("view",{staticClass:t._$s(11,"sc","empty"),attrs:{_i:11}})])},s=[]},e183:function(t,e,n){"use strict";n.r(e);var r=n("cb0c"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},e5cf:function(t,e,n){"use strict";n.r(e);var r=n("d1ca"),s=n("104b");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"1a24ff30",null,!1,r["a"],void 0);e["default"]=o.exports},e6db:function(t,e,n){var r=n("3b2d")["default"];t.exports=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!=r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports["default"]=t.exports},e8d3:function(t,e,n){"use strict";n.r(e);var r=n("3c68"),s=n("60f9");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"47ee0f51",null,!1,r["a"],void 0);e["default"]=o.exports},e910:function(t,e,n){if("undefined"===typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){throw n}))}))}),"undefined"!==typeof uni&&uni&&uni.requireGlobal){var r=uni.requireGlobal();ArrayBuffer=r.ArrayBuffer,Int8Array=r.Int8Array,Uint8Array=r.Uint8Array,Uint8ClampedArray=r.Uint8ClampedArray,Int16Array=r.Int16Array,Uint16Array=r.Uint16Array,Int32Array=r.Int32Array,Uint32Array=r.Uint32Array,Float32Array=r.Float32Array,Float64Array=r.Float64Array,BigInt64Array=r.BigInt64Array,BigUint64Array=r.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),__definePage("pages/auth/login",(function(){return Vue.extend(n("70f1").default)})),__definePage("pages/auth/register",(function(){return Vue.extend(n("306b").default)})),__definePage("pages/im/index",(function(){return Vue.extend(n("c8bb").default)})),__definePage("pages/friend/list",(function(){return Vue.extend(n("d6d9").default)})),__definePage("pages/friend/requests",(function(){return Vue.extend(n("4da1").default)})),__definePage("pages/friend/search",(function(){return Vue.extend(n("c94a").default)})),__definePage("pages/chat/session",(function(){return Vue.extend(n("ff66").default)})),__definePage("pages/common/webview",(function(){return Vue.extend(n("e8d3").default)})),__definePage("pages/settings/about",(function(){return Vue.extend(n("da75").default)})),__definePage("pages/settings/privacy",(function(){return Vue.extend(n("eb90").default)})),__definePage("pages/profile/me",(function(){return Vue.extend(n("4cf1").default)}))},eb90:function(t,e,n){"use strict";n.r(e);var r=n("cc86"),s=n("12d1");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"58e73be2",null,!1,r["a"],void 0);e["default"]=o.exports},ec46:function(t,e,n){"use strict";n.r(e);var r=n("fd75"),s=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},ee10:function(t,e){function n(t,e,n,r,s,i,a){try{var o=t[i](a),c=o.value}catch(u){return void n(u)}o.done?e(c):Promise.resolve(c).then(r,s)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(s,i){var a=t.apply(e,r);function o(t){n(a,s,i,o,c,"next",t)}function c(t){n(a,s,i,o,c,"throw",t)}o(void 0)}))}},t.exports.__esModule=!0,t.exports["default"]=t.exports},f3b9:function(t,e,n){"use strict";function r(t){var e=Object.prototype.toString.call(t);return e.substring(8,e.length-1)}function s(){return"string"===typeof __channelId__&&__channelId__}function i(t,e){switch(r(e)){case"Function":return"function() { [native code] }";default:return e}}function a(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];console[t].apply(console,n)}function o(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=e.shift();if(s())return e.push(e.pop().replace("at ","uni-app:///")),console[a].apply(console,e);var o=e.map((function(t){var e=Object.prototype.toString.call(t).toLowerCase();if("[object object]"===e||"[object array]"===e)try{t="---BEGIN:JSON---"+JSON.stringify(t,i)+"---END:JSON---"}catch(s){t=e}else if(null===t)t="---NULL---";else if(void 0===t)t="---UNDEFINED---";else{var n=r(t).toUpperCase();t="NUMBER"===n||"BOOLEAN"===n?"---BEGIN:"+n+"---"+t+"---END:"+n+"---":String(t)}return t})),c="";if(o.length>1){var u=o.pop();c=o.join("---COMMA---"),0===u.indexOf(" at ")?c+=u:c+="---COMMA---"+u}else c=o[0];console[a](c)}n.r(e),n.d(e,"log",(function(){return a})),n.d(e,"default",(function(){return o}))},fd47:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("7ca3")),i=n("8f59"),a=r(n("e5cf"));function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){(0,s.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var u={components:{Avatar:a.default},computed:c(c(c(c(c({},(0,i.mapState)("messages",["sessions","unread"])),(0,i.mapState)("friends",["list"])),(0,i.mapState)("auth",["user"])),(0,i.mapGetters)("messages",["unreadCount"])),{},{sessionList:function(){var t=this,e=Object.keys(this.sessions||{}),n={};(this.list||[]).forEach((function(t){n[t.id]=t}));var r=e.map((function(e){var r=Number(e),s=t.sessions[r],i=s.list[s.list.length-1];if(!i)return null;var a=n[r]||{},o=a.username||"\u7528\u6237".concat(r),c=a.avatar||"";return{peerId:r,name:o,avatar:c,preview:i.content,time:i.created_at.slice(0,16).replace("T"," "),unread:t.unreadCount(r)}}));return r.filter(Boolean).sort((function(t,e){return t.time<e.time?1:-1}))}}),onShow:function(){this.$store.dispatch("friends/loadFriends")},methods:{openChat:function(t){uni.navigateTo({url:"/pages/chat/session?peerId=".concat(t.peerId,"&name=").concat(encodeURIComponent(t.name))})}}};e.default=u},fd75:function(t,e,n){"use strict";var r=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(n("127e")),i=r(n("ee10")),a=r(n("7ca3")),o=n("8f59");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={data:function(){return{form:{username:"",password:""},loading:!1}},methods:u(u({},(0,o.mapActions)("auth",["login","fetchMe"])),{},{handleLogin:function(){var t=this;return(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.form.username&&t.form.password){e.next=3;break}return uni.showToast({title:"\u8bf7\u586b\u5199\u5b8c\u6574",icon:"none"}),e.abrupt("return");case 3:return t.loading=!0,e.prev=4,e.next=7,t.login(t.form);case 7:uni.showToast({title:"\u767b\u5f55\u6210\u529f",icon:"success"}),uni.reLaunch({url:"/pages/im/index"});case 9:return e.prev=9,t.loading=!1,e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[4,,9,12]])})))()},goRegister:function(){uni.navigateTo({url:"/pages/auth/register"})}})};e.default=f},fde0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.storageKeys=e.config=void 0;var r={baseURL:"http://39.105.171.247:8000",wsURL:"ws://39.105.171.247:8000/ws/chat",timeout:15e3};e.config=r;e.storageKeys={token:"im_token",user:"im_user"}},ff66:function(t,e,n){"use strict";n.r(e);var r=n("9afa"),s=n("47f6");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var a=n("828b"),o=Object(a["a"])(s["default"],r["b"],r["c"],!1,null,"3a6d436e",null,!1,r["a"],void 0);e["default"]=o.exports}},[["2e4e","app-config"]]]);